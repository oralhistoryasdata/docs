<!-- Bootstrap JS bundle -->
<script src="{{ '/assets/lib/bootstrap.bundle.min.js' | relative_url }}"></script>
<script>
    /* sidebar toggle for both mobile and desktop buttons */
    const sidebarToggle = document.body.querySelector('#sidebarToggle');
    const sidebarToggleDesktop = document.body.querySelector('#sidebarToggleDesktop');
    const sidebarNav = document.body.querySelector('#sidebar-wrapper');

    if (sidebarToggle) {
        sidebarToggle.addEventListener('click', event => {
            event.preventDefault();
            sidebarNav.classList.toggle('sidebar-show');
        });
    }

    if (sidebarToggleDesktop) {
        sidebarToggleDesktop.addEventListener('click', event => {
            event.preventDefault();
            sidebarNav.classList.toggle('sidebar-show');
        });
    }

    /* Sync search inputs between mobile and desktop */
    const searchInput = document.getElementById('jtd-search-input');
    const searchInputMobile = document.getElementById('jtd-search-input-mobile');
    const searchResultsMobile = document.getElementById('jtd-search-results-mobile');
    const jtdSearch = document.getElementById('jtd-search');

    if (searchInput && searchInputMobile) {
        // Create a MutationObserver once to sync desktop results to mobile
        if (searchResultsMobile && jtdSearch) {
            const desktopResultsElem = document.getElementById('jtd-search-results');
            const observer = new MutationObserver(function() {
                if (desktopResultsElem && desktopResultsElem.innerHTML) {
                    searchResultsMobile.innerHTML = desktopResultsElem.innerHTML;
                    // Show mobile results if there's a query
                    if (searchInputMobile.value.trim()) {
                        searchResultsMobile.style.display = 'block';
                    }
                }
            });
            if (desktopResultsElem) {
                observer.observe(desktopResultsElem, {
                    childList: true,
                    subtree: true
                });
            }
        }

        // When user types in mobile search, sync to desktop and trigger search
        searchInputMobile.addEventListener('input', function(e) {
            searchInput.value = e.target.value;
            // Trigger input event on desktop search to activate search functionality
            const inputEvent = new Event('input', { bubbles: true });
            searchInput.dispatchEvent(inputEvent);
        });

        // When user types in desktop search, sync to mobile
        searchInput.addEventListener('input', function(e) {
            searchInputMobile.value = e.target.value;
        });

        // Handle focus on mobile to show results if there's a query
        searchInputMobile.addEventListener('focus', function() {
            if (this.value.trim() && searchResultsMobile) {
                searchResultsMobile.style.display = 'block';
            }
        });

        // Handle blur on mobile to hide results (with delay to allow clicks)
        searchInputMobile.addEventListener('blur', function() {
            if (searchResultsMobile) {
                setTimeout(function() {
                    if (!searchResultsMobile.matches(':hover')) {
                        searchResultsMobile.style.display = 'none';
                    }
                }, 200);
            }
        });

        // Handle clicks on mobile search results
        if (searchResultsMobile) {
            searchResultsMobile.addEventListener('click', function(e) {
                e.preventDefault();
                const link = e.target.closest('a');
                if (link) {
                    const searchTerm = searchInputMobile.value.trim();
                    const targetUrl = new URL(link.href);
                    if (searchTerm) {
                        targetUrl.searchParams.set('highlight', searchTerm);
                    }
                    window.location.href = targetUrl.toString();
                }
            });
        }
    }
</script>
<!-- load other js -->
{% if page.foot %}{% include {{ page.foot }} %}{% endif %}
{% if layout.foot %}{% include {{ layout.foot }} %}{% endif %}
{% if layout.gallery == true or page.gallery == true %}<script src="{{ '/assets/lib/lazysizes.min.js' | relative_url }}" async></script>
<script src="{{ '/assets/lib/spotlight.min.js' | relative_url }}" defer></script>{% endif %}
{% include template/scroll-to-top.html %}
